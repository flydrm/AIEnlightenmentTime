# 代码注释质量验证SOP

## 1. 概述

本SOP定义了AI启蒙时光项目的代码注释质量验证标准和流程，特别强调核心功能类的注释要求和中文注释的重要性。

## 2. 验证原则

### 2.1 核心原则
- **核心功能优先**：Domain层和Presentation层的核心类必须100%注释覆盖
- **中文注释为主**：业务逻辑必须使用中文注释，提高可读性和维护性
- **分层差异化**：不同层级有不同的注释要求和权重
- **测试适度要求**：测试类注释要求适当降低，但必须说明测试意图

### 2.2 权重体系

| 层级 | 类型 | 权重 | 说明 |
|------|------|------|------|
| Domain | UseCase | 1.5 | 业务逻辑核心，必须详细注释 |
| Domain | Repository接口 | 1.5 | 数据契约定义，必须清晰 |
| Domain | Model | 1.5 | 领域模型，必须说明业务含义 |
| Presentation | ViewModel | 1.3 | UI逻辑中心，必须完整注释 |
| Presentation | Screen | 1.3 | 用户交互界面，必须说明交互流程 |
| Data | RepositoryImpl | 1.2 | 数据实现，必须说明策略 |
| Data | Manager | 1.2 | 系统管理器，必须说明职责 |
| Test | 所有测试类 | 0.5 | 简要说明测试目的即可 |
| Other | 其他类 | 1.0 | 基本注释要求 |

## 3. 验证标准

### 3.1 评分维度（总分100分）

#### 类/接口注释覆盖率（35分）
- 使用加权计算，核心类权重更高
- Domain层UseCase缺少注释扣1.5分
- 测试类缺少注释仅扣0.5分

#### 复杂方法注释（25分）
复杂度判定：
- 方法行数 > 20行
- 控制流语句 > 3个
- 业务关键路径（支付、认证、数据同步等）
- 算法实现（推荐、评分计算等）

**注：测试方法不计入统计**

#### UI组件交互注释（20分）
必须注释：
- 点击事件处理
- 手势交互
- 状态变化
- 动画效果
- 无障碍支持

#### 中文注释使用率（20分）
分层要求：
- Domain层：≥80%
- Presentation层：≥70%
- Data层：≥60%
- Test层：≥40%

### 3.2 评级标准

| 总分 | 等级 | 说明 | 行动 |
|------|------|------|------|
| 95-100 | A+ | 生产级标准 | 可直接发布 |
| 90-94 | A | 优秀 | 补充个别遗漏 |
| 85-89 | B | 良好 | 重点补充核心类 |
| 75-84 | C | 及格 | 系统性改进 |
| <75 | D/F | 不及格 | 不可发布，全面整改 |

## 4. 验证流程

### 4.1 自动化验证

1. **运行加权检查脚本**
```bash
cd /workspace
python3 docs/sop/validate/scripts/weighted-comment-check.py
```

2. **查看详细报告**
- 各层级注释统计
- 核心类注释情况
- 复杂方法覆盖率
- 中文注释比例
- 质量评分和等级

3. **根据报告改进**
- 优先补充权重高的核心类注释
- 重点关注Domain层和Presentation层
- 确保中文注释达到要求比例

### 4.2 人工复查

1. **核心类注释质量检查**
   - UseCase类是否说明了业务流程
   - ViewModel是否说明了状态管理
   - Repository是否说明了数据策略

2. **中文表达规范检查**
   - 专业术语使用是否准确
   - 语言表达是否清晰易懂
   - 是否符合团队规范

3. **注释时效性检查**
   - 注释是否与代码同步
   - 是否存在过时的注释
   - 是否有误导性说明

## 5. 常见问题处理

### 5.1 核心类识别不准确
**问题**：脚本未能正确识别某些核心类
**解决**：
1. 检查类命名是否符合规范
2. 必要时手动调整权重配置
3. 确保文件路径结构正确

### 5.2 中文注释乱码
**问题**：中文注释显示乱码
**解决**：
1. 确保文件编码为UTF-8
2. IDE设置正确的编码
3. Git配置支持中文

### 5.3 复杂方法判定争议
**问题**：某些方法是否需要注释存在争议
**解决**：
1. 遵循"宁多勿少"原则
2. 考虑未来维护需要
3. 团队讨论达成一致

## 6. 最佳实践

### 6.1 注释时机
- **编码时同步注释**：不要等到最后再补
- **重构时更新注释**：保持注释与代码一致
- **Code Review检查**：将注释作为必查项

### 6.2 注释内容
- **说明Why而非What**：解释设计决策
- **提供上下文**：说明业务背景
- **给出示例**：复杂功能提供用法示例

### 6.3 团队协作
- **统一规范**：全员遵守注释标准
- **知识传承**：通过注释传递业务知识
- **持续改进**：定期回顾和优化

## 7. 工具集成

### 7.1 CI/CD集成
```yaml
# .github/workflows/comment-check.yml
name: Comment Quality Check

on: [push, pull_request]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
      - name: Run comment check
        run: |
          python3 docs/sop/validate/scripts/weighted-comment-check.py
```

### 7.2 Git Hook
```bash
#!/bin/sh
# .git/hooks/pre-commit

echo "检查代码注释质量..."
python3 docs/sop/validate/scripts/weighted-comment-check.py

if [ $? -ne 0 ]; then
    echo "❌ 注释质量未达标，请补充注释后再提交"
    exit 1
fi
```

## 8. 验证报告模板

```markdown
# 代码注释质量验证报告

**项目**：AI启蒙时光
**日期**：[日期]
**验证人**：[姓名]

## 验证结果
- **总分**：XX/100
- **等级**：[等级]
- **结论**：[通过/不通过]

## 详细统计
[脚本输出结果]

## 改进建议
1. [建议1]
2. [建议2]

## 复查确认
- [ ] 核心类注释完整性
- [ ] 中文表达规范性
- [ ] 注释时效性
```

## 9. 附录

### 9.1 相关文档
- [代码注释规范](/docs/sop/project/09-comment-standards.md)
- [加权检查脚本](/docs/sop/validate/scripts/weighted-comment-check.py)

### 9.2 版本历史
- v1.0 (2024-12) - 初始版本，建立加权验证体系

---

**重要提示**：注释质量直接影响代码的可维护性和知识传承，必须严格执行本SOP。